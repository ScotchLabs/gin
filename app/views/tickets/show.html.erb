<!--
Where do error messages go?
What about multiple sections?
Can I AJAX it? If so, where would the page redirect?
How does it know the show is for Carnival? Homecoming? Festival?
How does it count tckets left for shows with multiple sections?
-->
<% ast = "<span style='color:#ff9900'>*</span>" %>
<div class='article'>
    <div id='ticketsleft' class='articleleft fleft'>
      <h1>Your Information</h1>
      <input type='hidden' id='form_showid' value='<%= @show.abbrev %>' />
      <br />
      <b>Name</b><br />
      <input type='text' id='form_name' /><br />
      <%= ast %>Required field.<br />
      <br />
      <b>Phone Number</b><br />
      <input type='text' id='form_phone' /><br />
      <%= ast %>Required field.<br />
      <br />
      <b>Email Address</b> (for receipt of reservation)<br />
      <input type='text' id='form_email' /><br />
      <br />
      Do you have a <b>Carnegie Mellon Student ID</b>?<br />
      <input type='radio' id='form_id_yes' name='form_id' onchange='updateprice()' />Yes<br />
      <input type='radio' id='form_id_no' name='form_id' onchange='updateprice()' />No<br />
      <%= ast %>Required field.
    </div>
    <div id='ticketsright' class='articleright fleft'>
      <h1>Ticket Reservations</h1>
      <% unless @show.housemanname.blank? %><span style='font-size:8pt;'>Questions? Contact House Manager <%= link_to @show.housemanname, "mailto:#{@show.housemanemail}" %>.</span><br /><% end %>
      <br />
      Use this form to reserve your tickets for Scotch'n'Soda's production of <b><%= @show.name %></b>, showing <%= @show.datetickets %> in <%= @show.loc %>. You will be able to pay and pick them up 30 minutes before showtime outside of the performance space.<br />
      <br />
      If tickets to your preffered show or section are sold out online, please try at the door 45 minutes before showtime; additional tickets will be available there<br />
      <br />
      Notes: <% unless @show.ticketnotes.blank? %><%= @show.ticketnotes %> <% end %><%= @show.sectioninfo %><br />
      <br />
      <h2>Select Dates, Sections, and Quantities</h2>
      <% i=0
      for perf in @show.performancetimes.split("|")
        soldout = @show.soldout(perf)
        performance = hidden_field(:form, "performance[#{i}]", :value => perf)
        quantity = text_field(:form, "quantity[#{i}]", {:onchange => "updateprice()", :size => "3"}) unless soldout
        quantity = text_field(:form, "quantity[#{i}]", {:onchange => "updateprice()", :size => "3", :disabled => true}) if soldout
        if @ticketsections.count > 1
          #only put sections that are available
          sections = select(:form, "section[#{i}]", @ticketsections.map {|t| [t.name, t.id]}, {}, {:onchange => "updateprice()"}) unless soldout
          sections = select(:form, "section[#{i}]", @ticketsections.map {|t| [t.name, t.id]}, {}, {:onchange => "updateprice()", :disabled => true}) if soldout
        end
        time = DateTime.parse(perf).strftime("%A, %B %d @ ").to_s
        time += DateTime.parse(perf).strftime("%I").to_i.to_s
        time += (DateTime.parse(perf).strftime("%p")=="PM")? ("p."):("a.")
        num = @show.ticketsavailable(perf).to_s+" left"
        num = "Sold out" if soldout
        time = "<b>#{time}</b> (#{num})"
        time = "<span style='color:#999999;'>#{time}</span>" if soldout
        %>
        <%= performance %>
        <%= quantity %>
        <%= sections %>
        <%= time %><br />
        <%
        i=i+1
      end %>
      <script type='text/javascript'>
        numperformances = <%= i %>;
        sections = new Array(<%= @ticketsections.size %>);
      <%
      i=0
      for section in @ticketsections %>
        sections[<%=i%>] = new Array(4);
        sections[<%=i%>]["id"] = "<%= section.id %>";
        sections[<%=i%>]["name"] = "<%= section.name %>";
        sections[<%=i%>]["pricewithid"] = <%= section.pricewithid %>;
        sections[<%=i%>]["pricewoutid"] = <%= section.pricewoutid %>;
        <%
        i=i+1
      end %>
      jQuery(document).ready(function(){
        if (jQuery("#ticketsleft").height() > jQuery("#ticketsright").height())
          jQuery("#ticketsright").height(jQuery("#ticketsleft").height());
        else
          jQuery("#ticketsleft").height(jQuery("#ticketsright").height());
      })
      </script>
      
      <br />
      You've selected <b><span id='numtickets'>0</span></b> tickets, for a total of <b>$<span id='pricetickets'>0</span></b>, to be paid for at the door. If this is correct, click the button below to confirm your reservation.<br />
      <br />
      <center><input id='form_submit' type='submit' value='Reserve!' onclick='reservetickets()' /></center>
    </div>
  <br clear='all' />
</div>